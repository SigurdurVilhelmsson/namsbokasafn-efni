{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://namsbokasafn.is/schemas/chapter-status.json",
  "title": "Chapter Status",
  "description": "Tracks translation workflow progress for a single chapter through the 8-step extract-inject-render pipeline",
  "type": "object",
  "required": ["titleEn", "status"],
  "properties": {
    "chapter": {
      "type": "integer",
      "minimum": 1,
      "description": "Chapter number"
    },
    "id": {
      "type": "string",
      "description": "Identifier for non-numeric chapters (e.g., 'appendices')"
    },
    "titleEn": {
      "type": "string",
      "minLength": 1,
      "description": "English chapter title"
    },
    "titleIs": {
      "type": ["string", "null"],
      "description": "Icelandic chapter title (null if not yet translated)"
    },
    "sections": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["id", "titleEn", "titleIs"],
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^\\d+\\.\\d+$",
            "description": "Section ID (e.g., '1.1', '2.3')"
          },
          "titleEn": {
            "type": "string",
            "description": "English section title"
          },
          "titleIs": {
            "type": "string",
            "description": "Icelandic section title (use 'TBD' if not yet translated)"
          }
        }
      }
    },
    "status": {
      "type": "object",
      "description": "8-step pipeline stages (extract-inject-render workflow)",
      "properties": {
        "extraction": {
          "$ref": "#/$defs/stageStatus",
          "description": "Step 1: CNXML -> EN segments + structure extracted"
        },
        "mtReady": {
          "$ref": "#/$defs/stageStatus",
          "description": "Step 1b: Segments protected and ready for machine translation"
        },
        "mtOutput": {
          "$ref": "#/$defs/stageStatus",
          "description": "Step 2: Machine translation output from malstadur.is"
        },
        "linguisticReview": {
          "$ref": "#/$defs/stageStatus",
          "description": "Step 3: Linguistic review (Pass 1) - faithful translation complete"
        },
        "tmCreated": {
          "$ref": "#/$defs/stageStatus",
          "description": "Step 4: TM created via Matecat Align"
        },
        "injection": {
          "$ref": "#/$defs/stageStatus",
          "description": "Step 5a: Translated segments injected into CNXML"
        },
        "rendering": {
          "$ref": "#/$defs/stageStatus",
          "description": "Step 5b: CNXML rendered to semantic HTML"
        },
        "publication": {
          "$ref": "#/$defs/publicationStatus",
          "description": "Step 5c: Published to web (synced to vefur)"
        }
      },
      "additionalProperties": false
    },
    "images": {
      "type": "object",
      "properties": {
        "total": {
          "type": ["integer", "null"],
          "minimum": 0,
          "description": "Total number of images requiring translation"
        },
        "translated": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of images translated"
        },
        "status": {
          "type": "string",
          "enum": ["not-started", "in-progress", "complete"],
          "description": "Image translation status"
        }
      }
    },
    "notes": {
      "type": "string",
      "description": "General notes about this chapter"
    }
  },
  "$defs": {
    "stageStatus": {
      "type": "object",
      "required": ["complete"],
      "additionalProperties": true,
      "properties": {
        "complete": {
          "type": "boolean",
          "description": "Whether this stage is complete"
        },
        "date": {
          "type": ["string", "null"],
          "pattern": "^\\d{4}-\\d{2}-\\d{2}$",
          "description": "Completion date (YYYY-MM-DD)"
        },
        "notes": {
          "type": "string",
          "description": "Notes about this stage"
        }
      }
    },
    "publicationStatus": {
      "type": "object",
      "description": "Publication status with separate tracks for MT preview, faithful, and localized versions",
      "properties": {
        "mtPreview": {
          "$ref": "#/$defs/stageStatus",
          "description": "MT preview track - machine-translated versions for immediate use"
        },
        "faithful": {
          "$ref": "#/$defs/stageStatus",
          "description": "Faithful track - human-reviewed faithful translations"
        },
        "localized": {
          "$ref": "#/$defs/stageStatus",
          "description": "Localized track - adapted for Icelandic students"
        }
      },
      "additionalProperties": false
    }
  }
}
