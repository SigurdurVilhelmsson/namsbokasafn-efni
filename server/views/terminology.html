<!DOCTYPE html>
<html lang="is">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Orðasafn - Námsbókasafn</title>
  <link rel="stylesheet" href="/css/common.css">
  <style>
    /* ==========================================================================
       TERMINOLOGY PAGE — Basalt & Vellum
       Search, filter, and manage the EN/IS chemistry glossary.
       ========================================================================== */

    /* ========================================
       SEARCH SECTION
       ======================================== */

    .search-section {
      margin-bottom: var(--spacing-lg);
    }

    .search-row {
      display: flex;
      gap: 0.75rem;
      margin-bottom: var(--spacing-md);
    }

    .search-field {
      flex: 1;
      position: relative;
    }

    .search-field svg {
      position: absolute;
      left: var(--spacing-md);
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-muted);
      pointer-events: none;
    }

    .search-field input {
      width: 100%;
      padding: 0.875rem var(--spacing-md) 0.875rem 2.75rem;
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      font-size: var(--text-md);
      font-family: var(--font-body);
      background: var(--bg-surface);
      color: var(--text-primary);
      transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
    }

    .search-field input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(200,121,65,0.15);
    }

    .search-field input::placeholder {
      color: var(--text-muted);
    }

    /* ========================================
       FILTER BAR
       ======================================== */

    .filter-bar {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
      align-items: center;
    }

    .filter-item {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }

    .filter-item label {
      font-size: var(--text-sm);
      color: var(--text-muted);
      white-space: nowrap;
      font-weight: 500;
    }

    .filter-item select {
      padding: 0.375rem 0.75rem;
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      font-size: var(--text-sm);
      font-family: var(--font-body);
      background: var(--bg-elevated);
      color: var(--text-primary);
      cursor: pointer;
      transition: border-color var(--transition-fast);
    }

    .filter-item select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(200,121,65,0.15);
    }

    .filter-count {
      margin-left: auto;
      font-size: var(--text-xs);
      color: var(--text-muted);
    }

    .filter-count strong {
      color: var(--accent);
    }

    /* ========================================
       STATS ROW
       ======================================== */

    .stats-row {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: var(--spacing-md);
      margin-bottom: var(--spacing-lg);
    }

    .stat-box {
      background: var(--bg-surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: var(--spacing-md);
      text-align: center;
    }

    .stat-box .stat-number {
      font-size: 1.5rem;
      font-weight: 700;
      font-family: var(--font-heading);
    }

    .stat-box .stat-label {
      font-size: var(--text-xs);
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.04em;
      margin-top: 2px;
    }

    .stat-number.color-total   { color: var(--accent); }
    .stat-number.color-success { color: var(--success); }
    .stat-number.color-warning { color: var(--warning); }
    .stat-number.color-error   { color: var(--error); }

    /* ========================================
       REVIEW QUEUE ALERT
       ======================================== */

    .review-alert {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem var(--spacing-md);
      background: var(--warning-subtle);
      border: 1px solid var(--warning);
      border-radius: var(--radius-md);
      margin-bottom: var(--spacing-lg);
      color: var(--warning);
      font-size: var(--text-base);
    }

    .review-alert a {
      color: var(--warning);
      font-weight: 600;
      text-decoration: underline;
    }

    .review-alert a:hover {
      color: var(--accent-hover);
    }

    /* ========================================
       TERM CARDS (Table-like Card Layout)
       ======================================== */

    .terms-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-md);
    }

    .terms-header h2 {
      font-family: var(--font-heading);
      font-size: var(--text-lg);
      font-weight: 600;
      color: var(--text-primary);
    }

    .terms-list {
      display: flex;
      flex-direction: column;
      gap: 1px;
      background: var(--border);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      overflow: hidden;
      margin-bottom: var(--spacing-md);
    }

    .terms-list-header {
      display: grid;
      grid-template-columns: 1fr 1fr 120px 110px 120px 60px;
      gap: var(--spacing-md);
      padding: 0.625rem 1rem;
      background: var(--bg-elevated);
      font-size: 0.6875rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
    }

    .term-card {
      display: grid;
      grid-template-columns: 1fr 1fr 120px 110px 120px 60px;
      gap: var(--spacing-md);
      align-items: center;
      padding: 0.75rem 1rem;
      background: var(--bg-surface);
      cursor: pointer;
      transition: background var(--transition-fast);
    }

    .term-card:hover {
      background: var(--bg-hover);
    }

    .term-en {
      font-weight: 500;
      color: var(--text-primary);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .term-is {
      color: var(--accent);
      font-weight: 500;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .term-category {
      font-size: var(--text-sm);
      color: var(--text-secondary);
    }

    .term-status .status-badge {
      font-size: var(--text-xs);
    }

    .term-source {
      font-size: var(--text-sm);
      color: var(--text-muted);
    }

    .term-actions {
      display: flex;
      justify-content: center;
    }

    .term-actions .btn-icon {
      width: 32px;
      height: 32px;
    }

    /* Empty / Loading / Error states inside term list */
    .terms-state {
      padding: var(--spacing-xl);
      text-align: center;
      background: var(--bg-surface);
      color: var(--text-muted);
      font-size: var(--text-base);
    }

    .terms-state.error {
      color: var(--error);
    }

    /* ========================================
       PAGINATION
       ======================================== */

    .pagination-row {
      display: flex;
      justify-content: center;
      padding: var(--spacing-md) 0;
    }

    /* ========================================
       DETAIL MODAL CONTENT
       ======================================== */

    .detail-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--spacing-md);
    }

    .detail-field label {
      display: block;
      font-size: var(--text-xs);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .detail-field span {
      font-size: var(--text-base);
      color: var(--text-primary);
    }

    .detail-full {
      grid-column: span 2;
    }

    /* Discussion section in detail modal */
    .discussion-section {
      margin-top: var(--spacing-lg);
      padding-top: var(--spacing-lg);
      border-top: 1px solid var(--border);
    }

    .discussion-section h4 {
      font-family: var(--font-heading);
      font-size: var(--text-base);
      font-weight: 600;
      margin-bottom: var(--spacing-md);
      color: var(--text-primary);
    }

    .discussions-list {
      max-height: 200px;
      overflow-y: auto;
      margin-bottom: var(--spacing-md);
    }

    .discussion-item {
      padding: 0.75rem;
      background: var(--bg-surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      margin-bottom: var(--spacing-sm);
    }

    .discussion-meta {
      display: flex;
      gap: var(--spacing-sm);
      font-size: var(--text-xs);
      margin-bottom: 4px;
    }

    .discussion-user {
      font-weight: 600;
      color: var(--text-primary);
    }

    .discussion-date {
      color: var(--text-muted);
    }

    .discussion-content {
      font-size: var(--text-base);
      color: var(--text-secondary);
    }

    .discussion-proposal {
      font-size: var(--text-sm);
      color: var(--accent);
      margin-top: 4px;
      font-weight: 500;
    }

    .add-discussion {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-sm);
    }

    .discussions-empty {
      color: var(--text-muted);
      font-size: var(--text-sm);
      font-style: italic;
      padding: var(--spacing-sm) 0;
    }

    /* ========================================
       IMPORT MODAL CONTENT
       ======================================== */

    .import-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--spacing-md);
      margin-bottom: var(--spacing-md);
    }

    .import-card {
      padding: var(--spacing-md);
      border: 2px solid var(--border);
      border-radius: var(--radius-lg);
      cursor: pointer;
      text-align: center;
      transition: all var(--transition-fast);
    }

    .import-card:hover {
      border-color: var(--accent);
      background: var(--accent-subtle);
    }

    .import-card svg {
      display: block;
      margin: 0 auto var(--spacing-sm);
      color: var(--accent);
    }

    .import-card h4 {
      font-family: var(--font-heading);
      font-size: var(--text-base);
      font-weight: 600;
      margin-bottom: 4px;
    }

    .import-card p {
      font-size: var(--text-xs);
      color: var(--text-muted);
      line-height: 1.4;
    }

    .file-drop-zone {
      border: 2px dashed var(--border);
      border-radius: var(--radius-lg);
      padding: var(--spacing-xl);
      text-align: center;
      margin-bottom: var(--spacing-md);
      transition: all var(--transition-fast);
    }

    .file-drop-zone.dragover {
      border-color: var(--accent);
      background: var(--accent-subtle);
    }

    .file-drop-zone svg {
      display: block;
      margin: 0 auto var(--spacing-sm);
      color: var(--text-muted);
    }

    .file-drop-zone a {
      color: var(--accent);
      cursor: pointer;
      font-weight: 500;
    }

    .import-result {
      text-align: center;
      padding: var(--spacing-md);
    }

    .import-result.success svg { color: var(--success); }
    .import-result.error svg { color: var(--error); }

    .import-result h4 {
      font-family: var(--font-heading);
      font-size: var(--text-md);
      margin: var(--spacing-sm) 0;
    }

    .import-result p {
      font-size: var(--text-sm);
      color: var(--text-secondary);
    }

    /* ========================================
       RESPONSIVE
       ======================================== */

    @media (max-width: 1024px) {
      .terms-list-header,
      .term-card {
        grid-template-columns: 1fr 1fr 100px 90px;
      }

      .terms-list-header .col-source,
      .terms-list-header .col-actions,
      .term-source,
      .term-actions {
        display: none;
      }
    }

    @media (max-width: 768px) {
      .stats-row {
        grid-template-columns: repeat(2, 1fr);
      }

      .search-row {
        flex-direction: column;
      }

      .filter-bar {
        flex-direction: column;
        align-items: flex-start;
      }

      .terms-list-header {
        display: none;
      }

      .term-card {
        grid-template-columns: 1fr;
        gap: var(--spacing-xs);
        padding: var(--spacing-md);
      }

      .term-card .term-status,
      .term-card .term-category {
        display: inline-block;
      }

      .detail-grid {
        grid-template-columns: 1fr;
      }

      .detail-full {
        grid-column: span 1;
      }

      .import-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <main class="page-content" id="main-content" data-page="terminology" data-title="Orðasafn">

    <!-- Search Section -->
    <div class="search-section">
      <div class="search-row">
        <div class="search-field">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
          <input type="text" id="search-input" placeholder="Leita a&eth; or&eth;i (enska e&eth;a &iacute;slenska)..." autocomplete="off">
        </div>
        <button class="btn btn-primary" onclick="searchTerms()">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
          Leita
        </button>
        <button class="btn btn-secondary" onclick="showAddModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
          B&#230;ta vi&#240;
        </button>
      </div>

      <div class="filter-bar">
        <div class="filter-item">
          <label for="filter-category">Flokkur:</label>
          <select id="filter-category" onchange="searchTerms(); updateFilterBadge();">
            <option value="">Allir flokkar</option>
          </select>
        </div>
        <div class="filter-item">
          <label for="filter-status">Sta&#240;a:</label>
          <select id="filter-status" onchange="searchTerms(); updateFilterBadge();">
            <option value="">Allar st&#246;&#240;ur</option>
            <option value="approved">Sam&#254;ykkt</option>
            <option value="proposed">&#205; bi&#240;</option>
            <option value="disputed">Til umr&#230;&#240;u</option>
            <option value="needs_review">&#222;arf yfirfer&#240;</option>
          </select>
        </div>
        <div class="filter-item">
          <label for="filter-source">Uppruni:</label>
          <select id="filter-source" onchange="searchTerms(); updateFilterBadge();">
            <option value="">Allir upprunar</option>
          </select>
        </div>
        <span class="filter-count" id="active-filters-badge" style="display: none;">
          <strong id="active-filter-num">0</strong> s&#237;ur virkar
        </span>
      </div>
    </div>

    <!-- Statistics -->
    <div class="stats-row" id="stats-row">
      <div class="stat-box">
        <div class="stat-number color-total" id="stat-total">-</div>
        <div class="stat-label">Samtals</div>
      </div>
      <div class="stat-box">
        <div class="stat-number color-success" id="stat-approved">-</div>
        <div class="stat-label">Sam&#254;ykkt</div>
      </div>
      <div class="stat-box">
        <div class="stat-number color-warning" id="stat-proposed">-</div>
        <div class="stat-label">&#205; bi&#240;</div>
      </div>
      <div class="stat-box">
        <div class="stat-number color-error" id="stat-disputed">-</div>
        <div class="stat-label">Til umr&#230;&#240;u</div>
      </div>
    </div>

    <!-- Review Queue Alert -->
    <div class="review-alert" id="review-queue-alert" style="display: none;">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
      <span><span id="review-queue-count"></span> or&#240; b&#237;&#240;a yfirfer&#240;ar.</span>
      <a href="#" onclick="showReviewQueue(); return false;">Sko&#240;a</a>
    </div>

    <!-- Terms List -->
    <div class="terms-header">
      <h2 id="results-title">Or&#240;asafn</h2>
      <button class="btn btn-sm btn-secondary" onclick="showImportModal()">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
        Flytja inn
      </button>
    </div>

    <div class="terms-list" id="terms-list">
      <div class="terms-list-header">
        <span>Enska</span>
        <span>&#205;slenska</span>
        <span>Flokkur</span>
        <span>Sta&#240;a</span>
        <span class="col-source">Uppruni</span>
        <span class="col-actions">A&#240;ger&#240;</span>
      </div>
      <div id="terms-body">
        <div class="terms-state">Hle&#240;ur...</div>
      </div>
    </div>

    <div class="pagination-row" id="pagination"></div>

  </main>

  <!-- Add/Edit Term Modal -->
  <div class="modal" role="dialog" aria-modal="true" id="term-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modal-title">B&#230;ta vi&#240; or&#240;i</h3>
        <button class="btn-close" onclick="closeModal('term-modal')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Enska *</label>
          <input type="text" id="term-english" class="form-input" placeholder="English term">
        </div>
        <div class="form-group">
          <label class="form-label">&#205;slenska *</label>
          <input type="text" id="term-icelandic" class="form-input" placeholder="&#205;slenskt or&#240;">
        </div>
        <div class="form-group">
          <label class="form-label">A&#240;rar &#254;&#253;&#240;ingar</label>
          <input type="text" id="term-alternatives" class="form-input" placeholder="A&#240;skili&#240; me&#240; kommu">
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Flokkur</label>
            <select id="term-category" class="form-select"></select>
          </div>
          <div class="form-group">
            <label class="form-label">Uppruni</label>
            <select id="term-source" class="form-select"></select>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Athugasemdir</label>
          <textarea id="term-notes" class="form-textarea" rows="3" placeholder="Vi&#240;b&#243;taruppl&#253;singar..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('term-modal')">H&#230;tta vi&#240;</button>
        <button class="btn btn-primary" id="save-term-btn" onclick="saveTerm()">Vista</button>
      </div>
    </div>
  </div>

  <!-- Term Detail Modal -->
  <div class="modal" role="dialog" aria-modal="true" id="detail-modal">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h3 id="detail-title">Or&#240;</h3>
        <button class="btn-close" onclick="closeModal('detail-modal')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="detail-grid">
          <div class="detail-field">
            <label>Enska:</label>
            <span id="detail-english"></span>
          </div>
          <div class="detail-field">
            <label>&#205;slenska:</label>
            <span id="detail-icelandic"></span>
          </div>
          <div class="detail-field">
            <label>A&#240;rar &#254;&#253;&#240;ingar:</label>
            <span id="detail-alternatives"></span>
          </div>
          <div class="detail-field">
            <label>Flokkur:</label>
            <span id="detail-category"></span>
          </div>
          <div class="detail-field">
            <label>Uppruni:</label>
            <span id="detail-source"></span>
          </div>
          <div class="detail-field">
            <label>Sta&#240;a:</label>
            <span id="detail-status"></span>
          </div>
          <div class="detail-field detail-full">
            <label>Athugasemdir:</label>
            <span id="detail-notes"></span>
          </div>
        </div>

        <!-- Discussion Section -->
        <div class="discussion-section">
          <h4>Umr&#230;&#240;ur</h4>
          <div id="discussions-list" class="discussions-list"></div>
          <div class="add-discussion">
            <textarea id="new-discussion" class="form-textarea" rows="2" placeholder="B&#230;ta vi&#240; athugasemd..."></textarea>
            <input type="text" id="proposed-translation" class="form-input" placeholder="Leggja til a&#240;ra &#254;&#253;&#240;ingu (valfr&#225;lst)">
            <button class="btn btn-secondary btn-sm" onclick="addDiscussion()">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
              B&#230;ta vi&#240; athugasemd
            </button>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('detail-modal')">Loka</button>
        <button class="btn btn-warning" id="dispute-btn" onclick="disputeTerm()">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"></path><line x1="4" y1="22" x2="4" y2="15"></line></svg>
          Senda til umr&#230;&#240;u
        </button>
        <button class="btn btn-success" id="approve-btn" onclick="approveTerm()">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
          Sam&#254;ykkja
        </button>
        <button class="btn btn-primary" onclick="editTerm()">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
          Breyta
        </button>
      </div>
    </div>
  </div>

  <!-- Import Modal -->
  <div class="modal" role="dialog" aria-modal="true" id="import-modal">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h3>Flytja inn or&#240;</h3>
        <button class="btn-close" onclick="closeModal('import-modal')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="import-grid">
          <div class="import-card" onclick="importExistingGlossary()">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>
            <h4>N&#250;verandi or&#240;alisti</h4>
            <p>Flytja inn terminology-en-is.csv &#250;r books/efnafraedi/glossary/</p>
          </div>
          <div class="import-card" onclick="showCsvUpload()">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
            <h4>CSV skr&#225;</h4>
            <p>Hla&#240;a upp CSV skr&#225; me&#240; english, icelandic d&#225;lkum</p>
          </div>
          <div class="import-card" onclick="showExcelUpload()">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line></svg>
            <h4>Excel skr&#225;</h4>
            <p>Flytja inn fr&#225; Efnaf&#233;laginu (Excel sni&#240;)</p>
          </div>
          <div class="import-card" onclick="importKeyTerms()">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path></svg>
            <h4>Lykilor&#240; &#250;r k&#246;flum</h4>
            <p>Draga &#250;t or&#240; &#250;r key-terms skr&#225;m</p>
          </div>
        </div>

        <div id="file-upload-section" style="display: none;">
          <input type="file" id="import-file" accept=".csv,.xlsx,.xls" style="display: none;">
          <div class="file-drop-zone" id="file-drop-zone">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="16 16 12 12 8 16"></polyline><line x1="12" y1="12" x2="12" y2="21"></line><path d="M20.39 18.39A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 3 16.3"></path><polyline points="16 16 12 12 8 16"></polyline></svg>
            <p>Drag&#240;u skr&#225; hinga&#240; e&#240;a <a href="#" onclick="document.getElementById('import-file').click(); return false;">veldu skr&#225;</a></p>
            <span id="selected-file-name" style="font-size:var(--text-sm);color:var(--text-muted)"></span>
          </div>
          <button class="btn btn-primary" onclick="uploadFile()" id="upload-btn" disabled>
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
            Hla&#240;a upp
          </button>
        </div>

        <div id="import-result" style="display: none;"></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('import-modal')">Loka</button>
      </div>
    </div>
  </div>

  <script src="/js/layout.js"></script>
  <script src="/js/theme.js"></script>
  <script src="/js/htmlUtils.js"></script>
  <script>
    /* ==========================================================================
       TERMINOLOGY PAGE — Client Logic
       All API calls, CRUD, search, filter, pagination, modals preserved.
       ========================================================================== */

    let currentUser = null;
    let currentTermId = null;
    let categories = [];
    let sources = [];
    let currentPage = 0;
    const pageSize = 50;

    // ─── Filter badge ─────────────────────────────────────────────

    function updateFilterBadge() {
      const category = document.getElementById('filter-category').value;
      const status = document.getElementById('filter-status').value;
      const source = document.getElementById('filter-source').value;

      let activeCount = 0;
      if (category) activeCount++;
      if (status) activeCount++;
      if (source) activeCount++;

      const badge = document.getElementById('active-filters-badge');
      const num = document.getElementById('active-filter-num');
      if (activeCount > 0) {
        num.textContent = activeCount;
        badge.style.display = 'inline';
      } else {
        badge.style.display = 'none';
      }
    }

    // ─── Initialization ───────────────────────────────────────────

    async function init() {
      // Wait for layout.js to provide auth via userLoaded event, or fetch it ourselves
      const authData = await fetchJson('/api/auth/me');

      if (!authData.authenticated) {
        // Not logged in — still show the glossary read-only
      } else {
        currentUser = authData.user;
      }

      // Load categories and sources
      await loadMetadata();

      // Load stats
      await loadStats();

      // Check review queue
      await checkReviewQueue();

      // Initial search
      await searchTerms();

      // Setup event listeners
      document.getElementById('search-input').addEventListener('keyup', (e) => {
        if (e.key === 'Enter') searchTerms();
      });
    }

    async function loadMetadata() {
      const data = await fetchJson('/api/terminology/categories');

      categories = data.categories;
      sources = data.sources;

      // Populate filter dropdowns
      const categorySelect = document.getElementById('filter-category');
      const sourceSelect = document.getElementById('filter-source');
      const termCategorySelect = document.getElementById('term-category');
      const termSourceSelect = document.getElementById('term-source');

      categories.forEach(cat => {
        categorySelect.innerHTML += '<option value="' + cat + '">' + formatCategory(cat) + '</option>';
        termCategorySelect.innerHTML += '<option value="' + cat + '">' + formatCategory(cat) + '</option>';
      });

      sources.forEach(src => {
        sourceSelect.innerHTML += '<option value="' + src + '">' + formatSource(src) + '</option>';
        termSourceSelect.innerHTML += '<option value="' + src + '">' + formatSource(src) + '</option>';
      });
    }

    async function loadStats() {
      const stats = await fetchJson('/api/terminology/stats');

      var byStatus = stats.byStatus || {};
      document.getElementById('stat-total').textContent = stats.total || 0;
      document.getElementById('stat-approved').textContent = byStatus.approved || 0;
      document.getElementById('stat-proposed').textContent = byStatus.proposed || 0;
      document.getElementById('stat-disputed').textContent = (byStatus.disputed || 0) + (byStatus.needsReview || 0);
    }

    async function checkReviewQueue() {
      if (!currentUser || !['admin', 'head-editor', 'editor'].includes(currentUser.role)) return;

      const data = await fetchJson('/api/terminology/review-queue?limit=1');

      if (data.terms && data.terms.length > 0) {
        document.getElementById('review-queue-count').textContent = data.terms.length + '+';
        document.getElementById('review-queue-alert').style.display = 'flex';
      }
    }

    // ─── Search & Display ─────────────────────────────────────────

    async function searchTerms() {
      const query = document.getElementById('search-input').value;
      const category = document.getElementById('filter-category').value;
      const status = document.getElementById('filter-status').value;

      const params = new URLSearchParams({
        limit: pageSize,
        offset: currentPage * pageSize
      });

      if (query) params.set('q', query);
      if (category) params.set('category', category);
      if (status) params.set('status', status);

      const tbody = document.getElementById('terms-body');
      tbody.innerHTML = '<div class="terms-state">Hle\u00F0ur...</div>';

      try {
        const data = await fetchJson('/api/terminology?' + params);

        if (!data.terms || data.terms.length === 0) {
          tbody.innerHTML = '<div class="terms-state">Engin or\u00F0 fundust.</div>';
          document.getElementById('results-title').textContent = 'Engin ni\u00F0urst\u00F6\u00F0ur';
          document.getElementById('pagination').innerHTML = '';
          return;
        }

        document.getElementById('results-title').textContent =
          'Ni\u00F0urst\u00F6\u00F0ur (' + data.pagination.total + ' or\u00F0)';

        tbody.innerHTML = data.terms.map(term => `
          <div class="term-card" tabindex="0" role="button" onclick="showTermDetail(${term.id})" onkeydown="if(event.key==='Enter')showTermDetail(${term.id})">
            <span class="term-en">${escapeHtml(term.english)}</span>
            <span class="term-is">${escapeHtml(term.icelandic)}</span>
            <span class="term-category">${formatCategory(term.category)}</span>
            <span class="term-status"><span class="status-badge status-${term.status}">${formatStatus(term.status)}</span></span>
            <span class="term-source">${formatSource(term.source)}</span>
            <span class="term-actions">
              <button class="btn-icon" onclick="event.stopPropagation(); showTermDetail(${term.id})" title="Sko\u00F0a">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
              </button>
            </span>
          </div>
        `).join('');

        // Update pagination
        renderPagination(data.pagination);

      } catch (err) {
        tbody.innerHTML = '<div class="terms-state error">Villa: ' + escapeHtml(err.message) + '</div>';
      }
    }

    // ─── Pagination ───────────────────────────────────────────────

    function renderPagination(pagination) {
      const totalPages = Math.ceil(pagination.total / pagination.limit);
      const currentPageNum = Math.floor(pagination.offset / pagination.limit);

      if (totalPages <= 1) {
        document.getElementById('pagination').innerHTML = '';
        return;
      }

      let html = '<div class="pagination-controls">';

      // Previous button
      html += '<button class="pagination-btn" onclick="goToPage(' + (currentPageNum - 1) + ')" ' +
              (currentPageNum === 0 ? 'disabled' : '') + '>' +
              '<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>' +
              '</button>';

      // Page numbers (show max 5 pages around current)
      const startPage = Math.max(0, currentPageNum - 2);
      const endPage = Math.min(totalPages - 1, currentPageNum + 2);

      if (startPage > 0) {
        html += '<button class="pagination-btn" onclick="goToPage(0)">1</button>';
        if (startPage > 1) {
          html += '<span class="pagination-info">...</span>';
        }
      }

      for (let i = startPage; i <= endPage; i++) {
        html += '<button class="pagination-btn' + (i === currentPageNum ? ' active' : '') + '" ' +
                'onclick="goToPage(' + i + ')">' + (i + 1) + '</button>';
      }

      if (endPage < totalPages - 1) {
        if (endPage < totalPages - 2) {
          html += '<span class="pagination-info">...</span>';
        }
        html += '<button class="pagination-btn" onclick="goToPage(' + (totalPages - 1) + ')">' + totalPages + '</button>';
      }

      // Next button
      html += '<button class="pagination-btn" onclick="goToPage(' + (currentPageNum + 1) + ')" ' +
              (currentPageNum >= totalPages - 1 ? 'disabled' : '') + '>' +
              '<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>' +
              '</button>';

      html += '</div>';

      document.getElementById('pagination').innerHTML = html;
    }

    function goToPage(page) {
      currentPage = page;
      searchTerms();
    }

    // ─── Term Detail ──────────────────────────────────────────────

    async function showTermDetail(id) {
      currentTermId = id;

      const data = await fetchJson('/api/terminology/' + id);
      const term = data.term;

      document.getElementById('detail-title').textContent = term.english;
      document.getElementById('detail-english').textContent = term.english;
      document.getElementById('detail-icelandic').textContent = term.icelandic;
      document.getElementById('detail-alternatives').textContent = term.alternatives?.join(', ') || '-';
      document.getElementById('detail-category').textContent = formatCategory(term.category);
      document.getElementById('detail-source').textContent = formatSource(term.source);
      document.getElementById('detail-notes').textContent = term.notes || '-';

      const statusEl = document.getElementById('detail-status');
      statusEl.innerHTML = '<span class="status-badge status-' + term.status + '">' + formatStatus(term.status) + '</span>';

      // Render discussions
      const discussionsList = document.getElementById('discussions-list');
      if (term.discussions && term.discussions.length > 0) {
        discussionsList.innerHTML = term.discussions.map(d => `
          <div class="discussion-item">
            <div class="discussion-meta">
              <span class="discussion-user">${escapeHtml(d.username)}</span>
              <span class="discussion-date">${formatDate(d.created_at)}</span>
            </div>
            <div class="discussion-content">${escapeHtml(d.comment)}</div>
            ${d.proposed_translation ? '<div class="discussion-proposal">Tillaga: <strong>' + escapeHtml(d.proposed_translation) + '</strong></div>' : ''}
          </div>
        `).join('');
      } else {
        discussionsList.innerHTML = '<p class="discussions-empty">Engar athugasemdir enn.</p>';
      }

      // Show/hide action buttons based on user role and term status
      const approveBtn = document.getElementById('approve-btn');
      const disputeBtn = document.getElementById('dispute-btn');

      approveBtn.style.display = 'none';
      disputeBtn.style.display = 'none';

      if (currentUser) {
        if (['admin', 'head-editor'].includes(currentUser.role) && term.status !== 'approved') {
          approveBtn.style.display = 'inline-flex';
        }
        if (term.status !== 'disputed') {
          disputeBtn.style.display = 'inline-flex';
        }
      }

      document.getElementById('detail-modal').style.display = 'flex';
    }

    // ─── Add / Edit ───────────────────────────────────────────────

    function showAddModal() {
      currentTermId = null;
      document.getElementById('modal-title').textContent = 'B\u00E6ta vi\u00F0 or\u00F0i';
      document.getElementById('term-english').value = '';
      document.getElementById('term-icelandic').value = '';
      document.getElementById('term-alternatives').value = '';
      document.getElementById('term-category').value = 'other';
      document.getElementById('term-source').value = 'manual';
      document.getElementById('term-notes').value = '';
      document.getElementById('term-english').disabled = false;
      document.getElementById('term-modal').style.display = 'flex';
    }

    function editTerm() {
      closeModal('detail-modal');
      // Load term data for editing
      fetchJson('/api/terminology/' + currentTermId)
        .then(data => {
          const term = data.term;
          document.getElementById('modal-title').textContent = 'Breyta or\u00F0i';
          document.getElementById('term-english').value = term.english;
          document.getElementById('term-english').disabled = true; // Can't change English term
          document.getElementById('term-icelandic').value = term.icelandic;
          document.getElementById('term-alternatives').value = term.alternatives?.join(', ') || '';
          document.getElementById('term-category').value = term.category;
          document.getElementById('term-source').value = term.source;
          document.getElementById('term-notes').value = term.notes || '';
          document.getElementById('term-modal').style.display = 'flex';
        });
    }

    async function saveTerm() {
      const english = document.getElementById('term-english').value.trim();
      const icelandic = document.getElementById('term-icelandic').value.trim();
      const alternatives = document.getElementById('term-alternatives').value
        .split(',').map(s => s.trim()).filter(s => s);
      const category = document.getElementById('term-category').value;
      const source = document.getElementById('term-source').value;
      const notes = document.getElementById('term-notes').value.trim();

      if (!english || !icelandic) {
        alert('Enska og \u00EDslenska eru nau\u00F0synleg');
        return;
      }

      const body = { english, icelandic, category, source, notes };
      if (alternatives.length > 0) body.alternatives = alternatives;

      try {
        const url = currentTermId ? '/api/terminology/' + currentTermId : '/api/terminology';
        const method = currentTermId ? 'PUT' : 'POST';

        const data = await fetchJson(url, {
          method,
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(body)
        });

        if (data.success || data.term) {
          closeModal('term-modal');
          document.getElementById('term-english').disabled = false;
          searchTerms();
          loadStats();
        } else {
          alert('Villa: ' + (data.message || 'Gat ekki vista\u00F0'));
        }
      } catch (err) {
        alert('Villa: ' + err.message);
      }
    }

    // ─── Approve / Dispute ────────────────────────────────────────

    async function approveTerm() {
      if (!confirm('Ertu viss um a\u00F0 \u00FE\u00FA viljir sam\u00FEykkja \u00FEetta or\u00F0?')) return;

      try {
        const data = await fetchJson('/api/terminology/' + currentTermId + '/approve', { method: 'POST' });

        if (data.success) {
          closeModal('detail-modal');
          searchTerms();
          loadStats();
        } else {
          alert('Villa: ' + data.message);
        }
      } catch (err) {
        alert('Villa: ' + err.message);
      }
    }

    async function disputeTerm() {
      const comment = prompt('Hvers vegna vilt \u00FE\u00FA senda \u00FEetta or\u00F0 til umr\u00E6\u00F0u?');
      if (!comment) return;

      try {
        const data = await fetchJson('/api/terminology/' + currentTermId + '/dispute', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ comment })
        });

        if (data.success) {
          showTermDetail(currentTermId); // Refresh
          searchTerms();
          loadStats();
        } else {
          alert('Villa: ' + data.message);
        }
      } catch (err) {
        alert('Villa: ' + err.message);
      }
    }

    // ─── Discussions ──────────────────────────────────────────────

    async function addDiscussion() {
      const comment = document.getElementById('new-discussion').value.trim();
      const proposedTranslation = document.getElementById('proposed-translation').value.trim();

      if (!comment) {
        alert('Athugasemd er nau\u00F0synleg');
        return;
      }

      try {
        const data = await fetchJson('/api/terminology/' + currentTermId + '/discuss', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ comment, proposedTranslation: proposedTranslation || undefined })
        });

        if (data.success) {
          document.getElementById('new-discussion').value = '';
          document.getElementById('proposed-translation').value = '';
          showTermDetail(currentTermId); // Refresh
        } else {
          alert('Villa: ' + data.message);
        }
      } catch (err) {
        alert('Villa: ' + err.message);
      }
    }

    // ─── Review Queue ─────────────────────────────────────────────

    function showReviewQueue() {
      document.getElementById('filter-status').value = 'disputed';
      searchTerms();
      updateFilterBadge();
    }

    // ─── Import ───────────────────────────────────────────────────

    function showImportModal() {
      document.getElementById('file-upload-section').style.display = 'none';
      document.getElementById('import-result').style.display = 'none';
      document.getElementById('import-modal').style.display = 'flex';
    }

    async function importExistingGlossary() {
      if (!confirm('Flytja inn n\u00FAverandi or\u00F0alista fr\u00E1 books/efnafraedi/glossary/terminology-en-is.csv?')) return;

      try {
        const data = await fetchJson('/api/terminology/import/existing-glossary', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ bookSlug: 'efnafraedi' })
        });
        showImportResult(data);
      } catch (err) {
        alert('Villa: ' + err.message);
      }
    }

    async function importKeyTerms() {
      if (!confirm('Draga \u00FAt or\u00F0 \u00FAr key-terms skr\u00E1m \u00ED efnafr\u00E6\u00F0i?')) return;

      try {
        const data = await fetchJson('/api/terminology/import/key-terms', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ bookSlug: 'efnafraedi' })
        });
        showImportResult(data);
      } catch (err) {
        alert('Villa: ' + err.message);
      }
    }

    let uploadType = 'csv';

    function showCsvUpload() {
      uploadType = 'csv';
      document.getElementById('import-file').accept = '.csv';
      document.getElementById('file-upload-section').style.display = 'block';
    }

    function showExcelUpload() {
      uploadType = 'excel';
      document.getElementById('import-file').accept = '.xlsx,.xls';
      document.getElementById('file-upload-section').style.display = 'block';
    }

    // File upload drag-and-drop + file input
    document.addEventListener('DOMContentLoaded', () => {
      const fileInput = document.getElementById('import-file');
      const dropZone = document.getElementById('file-drop-zone');

      if (fileInput && dropZone) {
        fileInput.addEventListener('change', (e) => {
          if (e.target.files.length > 0) {
            document.getElementById('selected-file-name').textContent = e.target.files[0].name;
            document.getElementById('upload-btn').disabled = false;
          }
        });

        dropZone.addEventListener('dragover', (e) => {
          e.preventDefault();
          dropZone.classList.add('dragover');
        });

        dropZone.addEventListener('dragleave', () => {
          dropZone.classList.remove('dragover');
        });

        dropZone.addEventListener('drop', (e) => {
          e.preventDefault();
          dropZone.classList.remove('dragover');
          if (e.dataTransfer.files.length > 0) {
            fileInput.files = e.dataTransfer.files;
            document.getElementById('selected-file-name').textContent = e.dataTransfer.files[0].name;
            document.getElementById('upload-btn').disabled = false;
          }
        });
      }
    });

    async function uploadFile() {
      const fileInput = document.getElementById('import-file');
      if (!fileInput.files.length) return;

      const formData = new FormData();
      formData.append('file', fileInput.files[0]);

      try {
        const endpoint = uploadType === 'csv' ? '/api/terminology/import/csv' : '/api/terminology/import/excel';
        const data = await fetchJson(endpoint, {
          method: 'POST',
          body: formData
        });
        showImportResult(data);
      } catch (err) {
        alert('Villa: ' + err.message);
      }
    }

    function showImportResult(data) {
      const resultEl = document.getElementById('import-result');
      if (data.success) {
        resultEl.innerHTML = `
          <div class="import-result success">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
            <h4>Innflutningur loki\u00F0!</h4>
            <p>B\u00E6tt vi\u00F0: ${data.added}</p>
            <p>Uppf\u00E6rt: ${data.updated || 0}</p>
            <p>Sleppt: ${data.skipped}</p>
          </div>
        `;
        searchTerms();
        loadStats();
      } else {
        resultEl.innerHTML = `
          <div class="import-result error">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>
            <h4>Villa vi\u00F0 innflutning</h4>
            <p>${escapeHtml(data.message || '\u00D3\u00FEekkt villa')}</p>
          </div>
        `;
      }
      resultEl.style.display = 'block';
    }

    // ─── Modal Helper ─────────────────────────────────────────────

    function closeModal(id) {
      document.getElementById(id).style.display = 'none';
    }

    // ─── Formatting Utilities ─────────────────────────────────────

    function formatCategory(cat) {
      const names = {
        'fundamental': 'Grunnhugt\u00F6k',
        'bonding': 'Efnatengi',
        'reactions': 'Efnahv\u00F6rf',
        'solutions': 'Lausnir',
        'acids-bases': 'S\u00FDrur og basar',
        'periodic-table': 'Lotukerfi',
        'structure': 'Bygging',
        'states': 'Efnis\u00E1stand',
        'properties': 'Eiginleikar',
        'changes': 'Breytingar',
        'measurements': 'M\u00E6lingar',
        'concepts': 'Hugt\u00F6k',
        'constants': 'Fastar',
        'units': 'Einingar',
        'other': 'Anna\u00F0'
      };
      return names[cat] || cat;
    }

    function formatSource(src) {
      const names = {
        'idordabankinn': '\u00CD\u00F0or\u00F0abankinn',
        'chemistry-association': 'Efnaf\u00E9lagi\u00F0',
        'chapter-glossary': 'Kaflaor\u00F0asafn',
        'manual': 'Handvirkt',
        'imported-csv': 'CSV innflutningur',
        'imported-excel': 'Excel innflutningur'
      };
      return names[src] || src;
    }

    function formatStatus(status) {
      const names = {
        'approved': 'Sam\u00FEykkt',
        'proposed': '\u00CD bi\u00F0',
        'disputed': 'Til umr\u00E6\u00F0u',
        'needs_review': '\u00DEarf yfirfer\u00F0'
      };
      return names[status] || status;
    }

    function formatDate(dateStr) {
      return new Date(dateStr).toLocaleDateString('is-IS', {
        year: 'numeric',
        month: 'short',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    // ─── Boot ─────────────────────────────────────────────────────

    init();
  </script>
</body>
</html>
