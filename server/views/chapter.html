<!DOCTYPE html>
<html lang="is">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kafla stj√≥rnbor√∞ - N√°msb√≥kasafn</title>
  <link rel="stylesheet" href="/css/common.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <header class="header">
    <h1>N√°msb√≥kasafn</h1>
    <nav>
      <a href="/my-work">M√≠n verkefni</a>
      <a href="/workflow">Verkfl√¶√∞i</a>
      <a href="/status">Stj√≥rnbor√∞</a>
      <a href="/segment-editor">Ritstj√≥ri</a>
      <a href="/terminology">Or√∞asafn</a>
      <span class="nav-separator admin-only"></span>
      <a href="/dashboard" class="admin-only">Stj√≥rnbor√∞</a>
      <a href="/admin" class="admin-only admin-link">Stj√≥rnandi</a>
    </nav>
    <div class="header-actions">
      <button class="theme-toggle" title="Skipta um √æema">
        <svg class="icon-sun" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
        <svg class="icon-moon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
      </button>
      <div class="notification-bell" id="notification-bell" title="Tilkynningar" style="display: none;">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>
        <span class="notification-badge" id="notification-count" style="display: none;">0</span>
      </div>
      <div class="user-info" id="user-info"></div>
    </div>
  </header>

  <main class="container">
    <!-- Chapter Selector -->
    <div class="chapter-selector" id="chapter-selector">
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">B√≥k</label>
          <select class="form-select" id="book-select">
            <option value="">Veldu b√≥k...</option>
            <option value="efnafraedi">Efnafr√¶√∞i</option>
            <option value="liffraedi">L√≠ffr√¶√∞i</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Kafli</label>
          <select class="form-select" id="chapter-select" disabled>
            <option value="">Veldu kafla...</option>
          </select>
        </div>
        <button class="btn btn-primary" id="load-btn" disabled>
          <i class="fas fa-sync-alt"></i> Hla√∞a kafla
        </button>
      </div>
    </div>

    <!-- Chapter Control Panel (shown after selection) -->
    <div id="control-panel" style="display: none;">
      <!-- Chapter Header -->
      <div class="chapter-header">
        <div class="chapter-title">
          <h1 id="chapter-title">Kafli</h1>
          <span class="chapter-badge" id="chapter-status">Hle√∞ur...</span>
        </div>
        <div class="chapter-actions">
          <a href="#" class="btn btn-secondary" id="editor-link">
            <i class="fas fa-edit"></i> Opna ritstj√≥ra
          </a>
        </div>
      </div>

      <!-- Quick Stats -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon"><i class="fas fa-file-alt"></i></div>
          <div class="stat-content">
            <div class="stat-value" id="stat-sections">-</div>
            <div class="stat-label">Hlutar</div>
          </div>
        </div>
        <div class="stat-card" id="stat-card-progress">
          <div class="stat-icon"><i class="fas fa-tasks"></i></div>
          <div class="stat-content">
            <div class="stat-value" id="stat-progress">-</div>
            <div class="stat-label">Framvinda</div>
          </div>
        </div>
        <div class="stat-card warning" id="stat-card-issues">
          <div class="stat-icon"><i class="fas fa-exclamation-triangle"></i></div>
          <div class="stat-content">
            <div class="stat-value" id="stat-issues">-</div>
            <div class="stat-label">Atri√∞i</div>
          </div>
        </div>
      </div>

      <!-- Blocked Issues Alert -->
      <div class="blocked-alert" id="blocked-alert" style="display: none;">
        <div class="blocked-alert-header">
          <i class="fas fa-hand-paper"></i>
          <strong>Vinna st√∂√∞vu√∞</strong>
        </div>
        <div class="blocked-alert-content" id="blocked-alert-content">
          <!-- Populated by JS -->
        </div>
      </div>

      <!-- Main Content Grid -->
      <div class="panel-grid">
        <!-- Sections Progress Panel -->
        <div class="panel">
          <div class="panel-header">
            <h2><i class="fas fa-list-check"></i> Hlutar</h2>
          </div>
          <div class="panel-body" id="sections-panel">
            <p class="text-muted">Hle√∞ur...</p>
          </div>
        </div>

        <!-- Issues Panel -->
        <div class="panel">
          <div class="panel-header">
            <h2><i class="fas fa-exclamation-triangle"></i> Atri√∞i</h2>
            <a href="#" class="btn btn-small btn-secondary" id="issues-link">
              <i class="fas fa-external-link-alt"></i> √ñll atri√∞i
            </a>
          </div>
          <div class="panel-body" id="issues-panel">
            <p class="text-muted">Hle√∞ur...</p>
          </div>
        </div>

        <!-- Recent Activity Panel -->
        <div class="panel">
          <div class="panel-header">
            <h2><i class="fas fa-history"></i> N√Ωleg virkni</h2>
          </div>
          <div class="panel-body" id="activity-panel">
            <p class="text-muted">Hle√∞ur...</p>
          </div>
        </div>
      </div>
    </div>
  </main>

    <script src="/js/htmlUtils.js"></script>
  <script>
    let currentBook = null;
    let currentChapter = null;
    let chapterData = null;

    async function init() {
      // Check auth
      const authRes = await fetch('/api/auth/me');
      const authData = await authRes.json();
      const userEl = document.getElementById('user-info');

      if (!authData.authenticated) {
        userEl.innerHTML = '<a href="/api/auth/login?redirect=/chapter" class="btn btn-primary">Innskr√°ning</a>';
        return;
      }

      // Check editor access
      if (!['admin', 'head-editor', 'editor'].includes(authData.user.role)) {
        document.querySelector('.container').innerHTML = `
          <div class="access-denied">
            <h2>A√∞gangur banna√∞ur</h2>
            <p>√ûessi s√≠√∞a er a√∞eins fyrir ritstj√≥ra.</p>
            <a href="/my-work" class="btn btn-primary">Til baka</a>
          </div>
        `;
        return;
      }

      userEl.innerHTML = '<img src="' + authData.user.avatar + '" alt=""><span>' + authData.user.name + '</span>';

      // Setup event listeners
      setupEventListeners();

      // Check URL params
      const params = new URLSearchParams(window.location.search);
      const book = params.get('book');
      const chapter = params.get('chapter');

      if (book && chapter) {
        document.getElementById('book-select').value = book;
        await loadChapters(book);
        document.getElementById('chapter-select').value = chapter;
        document.getElementById('load-btn').disabled = false;
        await loadChapter(book, chapter);
      }
    }

    function setupEventListeners() {
      document.getElementById('book-select').addEventListener('change', async (e) => {
        const book = e.target.value;
        if (book) {
          await loadChapters(book);
        } else {
          document.getElementById('chapter-select').disabled = true;
          document.getElementById('load-btn').disabled = true;
        }
      });

      document.getElementById('chapter-select').addEventListener('change', (e) => {
        document.getElementById('load-btn').disabled = !e.target.value;
      });

      document.getElementById('load-btn').addEventListener('click', () => {
        const book = document.getElementById('book-select').value;
        const chapter = document.getElementById('chapter-select').value;
        if (book && chapter) {
          loadChapter(book, chapter);
          // Update URL
          history.pushState(null, '', `/chapter?book=${book}&chapter=${chapter}`);
        }
      });
    }

    async function loadChapters(book) {
      const chapterSelect = document.getElementById('chapter-select');
      chapterSelect.disabled = true;
      chapterSelect.innerHTML = '<option value="">Hle√∞ur...</option>';

      try {
        const res = await fetch(`/api/books/${book}`);
        const data = await res.json();

        const chapters = data.chapters || [];
        chapterSelect.innerHTML = '<option value="">Veldu kafla...</option>' +
          chapters.map(ch =>
            `<option value="${ch.chapter}">Kafli ${ch.chapter}</option>`
          ).join('');

        chapterSelect.disabled = false;
      } catch (err) {
        console.error('Error loading chapters:', err);
        chapterSelect.innerHTML = '<option value="">Villa vi√∞ a√∞ hla√∞a k√∂flum</option>';
      }
    }

    async function loadChapter(book, chapter) {
      currentBook = book;
      currentChapter = chapter;

      document.getElementById('control-panel').style.display = 'block';
      document.getElementById('chapter-title').textContent = `Kafli ${chapter}`;

      // Update links
      document.getElementById('editor-link').href = `/segment-editor?book=${book}&chapter=${chapter}`;
      document.getElementById('issues-link').href = `/issues?book=${book}&chapter=${chapter}`;

      // Load all data in parallel
      await Promise.all([
        loadChapterSections(book, chapter),
        loadChapterIssues(book, chapter),
        loadChapterActivity(book, chapter)
      ]);
    }

    async function loadChapterSections(book, chapter) {
      const panel = document.getElementById('sections-panel');

      try {
        const res = await fetch(`/api/segment-editor/${book}/${chapter}`);
        const data = await res.json();

        const modules = data.modules || [];
        const faithful = modules.filter(m => m.hasFaithful).length;
        const total = modules.length;

        // Update stats
        document.getElementById('stat-sections').textContent = total;
        document.getElementById('stat-progress').textContent = `${faithful}/${total}`;

        // Update status badge
        const statusBadge = document.getElementById('chapter-status');
        if (faithful === total && total > 0) {
          statusBadge.textContent = 'Kl√°rt';
          statusBadge.className = 'chapter-badge complete';
        } else if (faithful > 0) {
          statusBadge.textContent = '√ç vinnslu';
          statusBadge.className = 'chapter-badge in-progress';
        } else {
          statusBadge.textContent = 'Ekki hafi√∞';
          statusBadge.className = 'chapter-badge pending';
        }

        // Render modules list
        if (modules.length === 0) {
          panel.innerHTML = '<p class="text-muted">Engir hlutar fundust</p>';
          return;
        }

        panel.innerHTML = modules.map(m => `
          <div class="section-item ${m.hasFaithful ? 'complete' : ''}">
            <div class="section-info">
              <span class="section-name">${escapeHtml(m.moduleId)}</span>
              <span class="section-source ${m.hasFaithful ? 'faithful' : 'mt'}">${m.hasFaithful ? 'Yfirfari√∞' : m.hasMtOutput ? 'V√©l√æ√Ω√∞ing' : 'Ekki √æ√Ωtt'}</span>
            </div>
            <a href="/segment-editor?book=${book}&chapter=${chapter}" class="btn btn-small btn-secondary">
              Opna
            </a>
          </div>
        `).join('');

      } catch (err) {
        console.error('Error loading sections:', err);
        panel.innerHTML = '<p class="text-error">Villa vi√∞ a√∞ hla√∞a hlutum</p>';
      }
    }

    async function loadChapterIssues(book, chapter) {
      const panel = document.getElementById('issues-panel');
      const blockedAlert = document.getElementById('blocked-alert');

      try {
        const res = await fetch(`/api/issues?book=${book}&chapter=${chapter}&status=pending`);
        const data = await res.json();

        const issues = [...(data.byCategory.BLOCKED || []), ...(data.byCategory.BOARD_REVIEW || []), ...(data.byCategory.EDITOR_CONFIRM || [])];

        // Update stats
        document.getElementById('stat-issues').textContent = issues.length;

        // Check for blocked issues
        const blocked = data.byCategory.BLOCKED || [];
        if (blocked.length > 0) {
          blockedAlert.style.display = 'block';
          document.getElementById('blocked-alert-content').innerHTML = blocked.map(b => `
            <div class="blocked-issue">
              <span class="blocked-description">${escapeHtml(b.description)}</span>
              <a href="/issues?id=${b.id}" class="btn btn-small">Leysa</a>
            </div>
          `).join('');
          document.getElementById('stat-card-issues').classList.add('critical');
        } else {
          blockedAlert.style.display = 'none';
          document.getElementById('stat-card-issues').classList.remove('critical');
        }

        if (issues.length === 0) {
          panel.innerHTML = '<p class="text-success">Engin atri√∞i √≠ bi√∞</p>';
          return;
        }

        panel.innerHTML = issues.slice(0, 10).map(i => `
          <div class="issue-item ${i.category.toLowerCase()}">
            <div class="issue-info">
              <span class="issue-category">${getCategoryLabel(i.category)}</span>
              <span class="issue-description">${escapeHtml(i.description || 'Engin l√Ωsing')}</span>
            </div>
          </div>
        `).join('') + (issues.length > 10 ? `
          <a href="/issues?book=${book}&chapter=${chapter}" class="show-more">
            +${issues.length - 10} fleiri atri√∞i
          </a>
        ` : '');

      } catch (err) {
        console.error('Error loading issues:', err);
        panel.innerHTML = '<p class="text-error">Villa vi√∞ a√∞ hla√∞a atri√∞i</p>';
      }
    }

    async function loadChapterActivity(book, chapter) {
      const panel = document.getElementById('activity-panel');

      try {
        const res = await fetch(`/api/activity?book=${book}&chapter=${chapter}&limit=10`);
        const data = await res.json();

        const activities = data.activities || [];

        if (activities.length === 0) {
          panel.innerHTML = '<p class="text-muted">Engin virkni skr√°√∞</p>';
          return;
        }

        panel.innerHTML = activities.map(a => `
          <div class="activity-item">
            <span class="activity-icon">${getActivityIcon(a.action)}</span>
            <div class="activity-content">
              <span class="activity-user">${escapeHtml(a.userName || 'Kerfi')}</span>
              <span class="activity-action">${escapeHtml(a.details)}</span>
              <span class="activity-time">${formatTimeAgo(a.timestamp)}</span>
            </div>
          </div>
        `).join('');

      } catch (err) {
        console.error('Error loading activity:', err);
        panel.innerHTML = '<p class="text-muted">Engin virkni</p>';
      }
    }

    // Helper functions
    function formatTimeAgo(dateStr) {
      if (!dateStr) return '';
      const date = new Date(dateStr);
      const now = new Date();
      const diffMs = now - date;
      const diffMins = Math.floor(diffMs / 60000);
      const diffHours = Math.floor(diffMs / 3600000);
      const diffDays = Math.floor(diffMs / 86400000);

      if (diffMins < 1) return 'R√©tt √≠ √æessu';
      if (diffMins < 60) return `${diffMins} m√≠n s√≠√∞an`;
      if (diffHours < 24) return `${diffHours} klst s√≠√∞an`;
      if (diffDays === 1) return '√ç g√¶r';
      return `${diffDays} d√∂gum s√≠√∞an`;
    }

    function getCategoryLabel(category) {
      const labels = {
        'BLOCKED': 'St√∂√∞va√∞',
        'BOARD_REVIEW': 'Umr√¶√∞a',
        'EDITOR_CONFIRM': 'Yfirfer√∞',
        'AUTO_FIX': 'Sj√°lfvirk'
      };
      return labels[category] || category;
    }

    function getActivityIcon(action) {
      const icons = {
        'edit': '‚úèÔ∏è', 'submit': 'üì§', 'approve': '‚úÖ', 'reject': '‚ùå',
        'assignment_created': 'üë§', 'assignment_completed': '‚úì'
      };
      return icons[action] || 'üìå';
    }

    // Initialize
    init();
  </script>

  <script src="/js/theme.js"></script>

  <style>
    /* Page-specific styles for chapter management */

    /* Header */
    .header {
      padding: 1rem 2rem;
      gap: 2rem;
    }
    .header nav { display: flex; gap: 1rem; flex: 1; }
    .header nav a {
      padding: 0.5rem 0.75rem;
      border-radius: 0.375rem;
    }
    .header nav a:hover { color: var(--gray-700); background: var(--gray-100); }
    .header nav a.active { color: var(--primary); background: var(--primary-light); font-weight: 500; }
    .user-info { display: flex; align-items: center; gap: 0.5rem; }
    .user-info img { width: 32px; height: 32px; border-radius: 50%; }

    /* Container */
    .container { max-width: 1200px; margin: 0 auto; padding: 2rem; }

    /* Chapter Selector */
    .chapter-selector {
      background: white;
      padding: 1.5rem;
      border-radius: 0.5rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      margin-bottom: 1.5rem;
    }
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr auto;
      gap: 1rem;
      align-items: end;
    }
    .form-group { display: flex; flex-direction: column; gap: 0.25rem; }
    .form-label { font-size: 0.875rem; font-weight: 500; color: var(--gray-700); }
    .form-select, .form-input, .form-textarea {
      padding: 0.625rem 0.875rem;
      border: 1px solid var(--gray-300);
      border-radius: 0.375rem;
      font-size: 0.875rem;
    }
    .form-textarea { resize: vertical; }

    /* Chapter Header */
    .chapter-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }
    .chapter-title {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    .chapter-title h1 { font-size: 1.5rem; }
    .chapter-badge {
      padding: 0.375rem 0.875rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    .chapter-badge.complete { background: var(--success-light); color: #166534; }
    .chapter-badge.in-progress { background: var(--primary-light); color: #1e40af; }
    .chapter-badge.pending { background: var(--gray-200); color: var(--gray-700); }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    .stat-card {
      background: white;
      padding: 1.25rem;
      border-radius: 0.5rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    .stat-icon {
      width: 48px;
      height: 48px;
      background: var(--primary-light);
      color: var(--primary);
      border-radius: 0.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
    }
    .stat-card.warning .stat-icon { background: var(--warning-light); color: var(--warning); }
    .stat-card.critical .stat-icon { background: var(--error-light); color: var(--error); }
    .stat-value { font-size: 1.5rem; font-weight: 700; color: var(--gray-900); }
    .stat-label { font-size: 0.75rem; color: var(--gray-500); }

    /* Blocked Alert */
    .blocked-alert {
      background: var(--error-light);
      border: 2px solid var(--error);
      border-radius: 0.5rem;
      margin-bottom: 1.5rem;
      overflow: hidden;
    }
    .blocked-alert-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1rem;
      background: rgba(220, 38, 38, 0.1);
      color: #991b1b;
    }
    .blocked-alert-content { padding: 1rem; }
    .blocked-issue {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem;
      background: white;
      border-radius: 0.375rem;
      margin-bottom: 0.5rem;
    }
    .blocked-issue:last-child { margin-bottom: 0; }

    /* Panel Grid */
    .panel-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1.5rem;
    }
    .panel {
      background: white;
      border-radius: 0.5rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.25rem;
      background: var(--gray-50);
      border-bottom: 1px solid var(--gray-200);
    }
    .panel-header h2 {
      font-size: 1rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .panel-body {
      padding: 1rem 1.25rem;
      max-height: 400px;
      overflow-y: auto;
    }

    /* Section Items */
    .section-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 0;
      border-bottom: 1px solid var(--gray-100);
    }
    .section-item:last-child { border-bottom: none; }
    .section-info { display: flex; align-items: center; gap: 0.75rem; }
    .section-name { font-weight: 500; }
    .section-source {
      font-size: 0.75rem;
      padding: 0.125rem 0.5rem;
      border-radius: 0.25rem;
    }
    .section-source.faithful { background: var(--success-light); color: #166534; }
    .section-source.mt-output { background: var(--warning-light); color: #92400e; }

    /* Issue Items */
    .issue-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.5rem 0;
      border-bottom: 1px solid var(--gray-100);
    }
    .issue-item:last-child { border-bottom: none; }
    .issue-category {
      font-size: 0.625rem;
      padding: 0.125rem 0.375rem;
      border-radius: 0.25rem;
      font-weight: 600;
      text-transform: uppercase;
    }
    .issue-item.blocked .issue-category { background: var(--error-light); color: #991b1b; }
    .issue-item.board_review .issue-category { background: var(--warning-light); color: #92400e; }
    .issue-item.editor_confirm .issue-category { background: var(--primary-light); color: #1e40af; }
    .issue-description { font-size: 0.875rem; color: var(--gray-600); }
    .show-more {
      display: block;
      text-align: center;
      padding: 0.5rem;
      color: var(--primary);
      text-decoration: none;
      font-size: 0.875rem;
    }

    /* Activity Items */
    .activity-item {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 0.5rem 0;
      border-bottom: 1px solid var(--gray-100);
    }
    .activity-item:last-child { border-bottom: none; }
    .activity-icon { font-size: 1rem; }
    .activity-content { flex: 1; font-size: 0.875rem; }
    .activity-user { font-weight: 500; }
    .activity-time { display: block; font-size: 0.75rem; color: var(--gray-500); }

    /* Empty State */
    .empty-state { text-align: center; padding: 2rem; color: var(--gray-500); }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.625rem 1rem;
      border: none;
      border-radius: 0.375rem;
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      text-decoration: none;
      transition: all 0.15s;
    }
    .btn-primary { background: var(--primary); color: white; }
    .btn-primary:hover { background: var(--primary-dark); }
    .btn-secondary { background: var(--gray-200); color: var(--gray-700); }
    .btn-secondary:hover { background: var(--gray-300); }
    .btn-small { padding: 0.375rem 0.75rem; font-size: 0.8125rem; }

    /* Text utilities */
    .text-muted { color: var(--gray-500); }
    .text-success { color: var(--success); }
    .text-error { color: var(--error); }

    /* Access Denied */
    .access-denied {
      text-align: center;
      padding: 4rem 2rem;
    }
    .access-denied h2 { margin-bottom: 1rem; }
    .access-denied p { margin-bottom: 1.5rem; color: var(--gray-500); }

    /* Responsive */
    @media (max-width: 1024px) {
      .stats-grid { grid-template-columns: repeat(2, 1fr); }
      .panel-grid { grid-template-columns: 1fr; }
    }
    @media (max-width: 640px) {
      .header { flex-direction: column; gap: 1rem; padding: 1rem; }
      .header nav { width: 100%; justify-content: center; }
      .container { padding: 1rem; }
      .form-row { grid-template-columns: 1fr; }
      .stats-grid { grid-template-columns: 1fr; }
    }
  </style>

  <script src="/js/theme.js"></script>
</body>
</html>
