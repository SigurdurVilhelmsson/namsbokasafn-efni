<!DOCTYPE html>
<html lang="is">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Skiladagar - Námsbókasafn</title>
  <link rel="stylesheet" href="/css/common.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <header class="header">
    <h1>Námsbókasafn</h1>
    <nav>
      <a href="/my-work">Mín verkefni</a>
      <a href="/workflow">Verkflæði</a>
      <a href="/status">Stjórnborð</a>
      <a href="/editor">Ritstjóri</a>
      <a href="/terminology">Orðasafn</a>
      <a href="/decisions">Ákvarðanir</a>
      <span class="nav-separator admin-only"></span>
      <a href="/dashboard" class="admin-only">Stjórnborð</a>
      <a href="/admin" class="admin-only admin-link">Stjórnandi</a>
    </nav>
    <div class="header-actions">
      <button class="theme-toggle" title="Skipta um þema">
        <svg class="icon-sun" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
        <svg class="icon-moon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
      </button>
      <div class="notification-bell" id="notification-bell" title="Tilkynningar" style="display: none;">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>
        <span class="notification-badge" id="notification-count" style="display: none;">0</span>
      </div>
      <div class="user-info" id="user-info"></div>
    </div>
  </header>

  <main class="container">
    <div class="page-header">
      <div class="page-title">
        <h2><i class="fas fa-calendar-check"></i> Skiladagar</h2>
        <p class="text-muted">Yfirlit yfir alla tímafrest og stöðu verkefna</p>
      </div>
      <div class="page-actions">
        <select class="form-select" id="book-filter">
          <option value="">Allar bækur</option>
          <option value="efnafraedi">Efnafræði</option>
          <option value="liffraedi">Líffræði</option>
        </select>
        <select class="form-select" id="view-mode">
          <option value="list">Listi</option>
          <option value="calendar">Dagatal</option>
        </select>
        <button class="btn btn-secondary" id="refresh-btn">
          <i class="fas fa-sync-alt"></i>
        </button>
      </div>
    </div>

    <!-- Health Score and Alerts -->
    <div class="alerts-bar" id="alerts-bar">
      <div class="health-score" id="health-score">
        <div class="score-circle">
          <span class="score-value">--</span>
        </div>
        <div class="score-label">Heilsustig</div>
      </div>
      <div class="alert-summary" id="alert-summary">
        <div class="alert-item critical" id="alert-critical">
          <i class="fas fa-exclamation-circle"></i>
          <span class="alert-count">0</span>
          <span class="alert-label">Liðnir</span>
        </div>
        <div class="alert-item high" id="alert-high">
          <i class="fas fa-clock"></i>
          <span class="alert-count">0</span>
          <span class="alert-label">Í dag</span>
        </div>
        <div class="alert-item medium" id="alert-medium">
          <i class="fas fa-hourglass-half"></i>
          <span class="alert-count">0</span>
          <span class="alert-label">3 dagar</span>
        </div>
        <div class="alert-item low" id="alert-low">
          <i class="fas fa-calendar-day"></i>
          <span class="alert-count">0</span>
          <span class="alert-label">Vika</span>
        </div>
      </div>
    </div>

    <!-- Stats Cards -->
    <div class="stats-cards" id="stats-cards">
      <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-tasks"></i></div>
        <div class="stat-content">
          <div class="stat-value" id="stat-total">-</div>
          <div class="stat-label">Heildarverkefni</div>
        </div>
      </div>
      <div class="stat-card overdue">
        <div class="stat-icon"><i class="fas fa-exclamation-triangle"></i></div>
        <div class="stat-content">
          <div class="stat-value" id="stat-overdue">-</div>
          <div class="stat-label">Tímafrestur liðinn</div>
        </div>
      </div>
      <div class="stat-card warning">
        <div class="stat-icon"><i class="fas fa-hourglass-start"></i></div>
        <div class="stat-content">
          <div class="stat-value" id="stat-due-soon">-</div>
          <div class="stat-label">Innan 3 daga</div>
        </div>
      </div>
      <div class="stat-card info">
        <div class="stat-icon"><i class="fas fa-calendar-week"></i></div>
        <div class="stat-content">
          <div class="stat-value" id="stat-this-week">-</div>
          <div class="stat-label">Þessa viku</div>
        </div>
      </div>
    </div>

    <!-- List View -->
    <div class="view-container" id="list-view">
      <div class="deadline-sections" id="deadline-sections">
        <div class="loading">
          <i class="fas fa-spinner fa-spin"></i> Hleður...
        </div>
      </div>
    </div>

    <!-- Calendar View -->
    <div class="view-container" id="calendar-view" style="display: none;">
      <div class="calendar-header">
        <button class="btn btn-secondary" id="prev-month">
          <i class="fas fa-chevron-left"></i>
        </button>
        <h3 id="calendar-title">...</h3>
        <button class="btn btn-secondary" id="next-month">
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
      <div class="calendar-grid" id="calendar-grid">
        <div class="loading">
          <i class="fas fa-spinner fa-spin"></i> Hleður...
        </div>
      </div>
    </div>

    <!-- User Breakdown -->
    <div class="user-breakdown card" id="user-breakdown">
      <h3><i class="fas fa-users"></i> Skipting eftir notendum</h3>
      <div class="user-list" id="user-list">
        <div class="loading">
          <i class="fas fa-spinner fa-spin"></i> Hleður...
        </div>
      </div>
    </div>
  </main>

    <script src="/js/htmlUtils.js"></script>
  <script>
    let currentMonth = new Date().getMonth() + 1;
    let currentYear = new Date().getFullYear();
    let currentView = 'list';

    async function init() {
      await loadUserInfo();
      await Promise.all([
        loadDeadlines(),
        loadStats(),
        loadAlerts()
      ]);

      // Event listeners
      document.getElementById('book-filter').addEventListener('change', refreshAll);
      document.getElementById('view-mode').addEventListener('change', switchView);
      document.getElementById('refresh-btn').addEventListener('click', refreshAll);
      document.getElementById('prev-month').addEventListener('click', () => changeMonth(-1));
      document.getElementById('next-month').addEventListener('click', () => changeMonth(1));
    }

    async function loadUserInfo() {
      try {
        const res = await fetch('/api/auth/me');
        const data = await res.json();

        if (data.user) {
          document.getElementById('user-info').innerHTML = `
            <span>${data.user.username}</span>
            <span class="badge badge-${data.user.role}">${data.user.role}</span>
          `;
        }
      } catch (err) {
        console.error('Failed to load user info:', err);
      }
    }

    async function refreshAll() {
      await Promise.all([
        loadDeadlines(),
        loadStats(),
        loadAlerts(),
        currentView === 'calendar' ? loadCalendar() : Promise.resolve()
      ]);
    }

    function switchView(e) {
      currentView = e.target.value;
      document.getElementById('list-view').style.display = currentView === 'list' ? 'block' : 'none';
      document.getElementById('calendar-view').style.display = currentView === 'calendar' ? 'block' : 'none';

      if (currentView === 'calendar') {
        loadCalendar();
      }
    }

    async function loadDeadlines() {
      const container = document.getElementById('deadline-sections');
      const book = document.getElementById('book-filter').value;

      container.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Hleður...</div>';

      try {
        const params = new URLSearchParams({ days: '60' });
        if (book) params.append('book', book);

        const res = await fetch('/api/deadlines?' + params);
        const data = await res.json();

        renderDeadlineList(data);

      } catch (err) {
        console.error('Failed to load deadlines:', err);
        container.innerHTML = '<div class="error">Villa við að hlaða skiladögum</div>';
      }
    }

    function renderDeadlineList(data) {
      const container = document.getElementById('deadline-sections');

      if (!data.deadlines || data.deadlines.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-check-circle"></i>
            <h3>Engin verkefni í bið</h3>
            <p>Öll verkefni hafa verið kláruð!</p>
          </div>
        `;
        return;
      }

      // Group by status
      const groups = {
        overdue: { title: 'Tímafrestur liðinn', class: 'overdue', icon: 'fa-exclamation-circle', items: [] },
        'due-soon': { title: 'Skilar innan 3 daga', class: 'due-soon', icon: 'fa-clock', items: [] },
        'this-week': { title: 'Skilar þessa viku', class: 'this-week', icon: 'fa-calendar-week', items: [] },
        upcoming: { title: 'Væntanlegt', class: 'upcoming', icon: 'fa-calendar-alt', items: [] },
        'no-date': { title: 'Án skiladags', class: 'no-date', icon: 'fa-question-circle', items: [] }
      };

      for (const d of data.deadlines) {
        if (groups[d.deadlineStatus]) {
          groups[d.deadlineStatus].items.push(d);
        }
      }

      let html = '';

      for (const [key, group] of Object.entries(groups)) {
        if (group.items.length === 0) continue;

        html += `
          <div class="deadline-section ${group.class}">
            <div class="section-header">
              <h3><i class="fas ${group.icon}"></i> ${group.title}</h3>
              <span class="section-count">${group.items.length}</span>
            </div>
            <div class="section-items">
        `;

        for (const item of group.items) {
          html += renderDeadlineItem(item);
        }

        html += '</div></div>';
      }

      container.innerHTML = html;
    }

    function renderDeadlineItem(item) {
      const statusBadge = getStatusBadge(item);

      return `
        <div class="deadline-item">
          <div class="item-left">
            ${statusBadge}
            <div class="item-info">
              <div class="item-title">${item.book} kafli ${item.chapter}</div>
              <div class="item-stage">${item.stageLabel}</div>
            </div>
          </div>
          <div class="item-middle">
            <div class="item-assignee">
              <i class="fas fa-user"></i> ${escapeHtml(item.assignedTo || 'Ekki úthlutað')}
            </div>
          </div>
          <div class="item-right">
            ${item.dueDate ? `
              <div class="item-date ${item.deadlineStatus}">
                <i class="fas fa-calendar"></i>
                ${item.dueDateFormatted}
              </div>
              <div class="item-days">
                ${getDaysLabel(item)}
              </div>
            ` : '<span class="no-date">Enginn skiladagur</span>'}
          </div>
          <div class="item-actions">
            <a href="/editor?book=${item.book}&chapter=${item.chapter}" class="btn btn-secondary btn-tiny">
              <i class="fas fa-edit"></i>
            </a>
          </div>
        </div>
      `;
    }

    function getStatusBadge(item) {
      switch (item.deadlineStatus) {
        case 'overdue':
          return `<span class="status-badge overdue">${item.daysOverdue}d seint</span>`;
        case 'due-soon':
          return `<span class="status-badge due-soon">${item.daysUntil}d</span>`;
        case 'this-week':
          return `<span class="status-badge this-week">${item.daysUntil}d</span>`;
        case 'upcoming':
          return `<span class="status-badge upcoming">${item.daysUntil}d</span>`;
        default:
          return `<span class="status-badge no-date">--</span>`;
      }
    }

    function getDaysLabel(item) {
      if (item.deadlineStatus === 'overdue') {
        return `<span class="days-overdue">${item.daysOverdue} ${item.daysOverdue === 1 ? 'dagur' : 'dagar'} seint</span>`;
      } else if (item.daysUntil === 0) {
        return '<span class="days-today">Í dag!</span>';
      } else if (item.daysUntil === 1) {
        return '<span class="days-tomorrow">Á morgun</span>';
      } else {
        return `<span class="days-left">${item.daysUntil} dagar eftir</span>`;
      }
    }

    async function loadStats() {
      const book = document.getElementById('book-filter').value;

      try {
        const params = new URLSearchParams();
        if (book) params.append('book', book);

        const res = await fetch('/api/deadlines/stats?' + params);
        const stats = await res.json();

        // Update stat cards
        document.getElementById('stat-total').textContent = stats.total;
        document.getElementById('stat-overdue').textContent = stats.overdue;
        document.getElementById('stat-due-soon').textContent = stats.dueSoon;
        document.getElementById('stat-this-week').textContent = stats.dueThisWeek;

        // Update health score
        updateHealthScore(stats.summary?.healthScore || 0);

        // Render user breakdown
        renderUserBreakdown(stats.byUser);

      } catch (err) {
        console.error('Failed to load stats:', err);
      }
    }

    function updateHealthScore(score) {
      const circle = document.querySelector('.score-circle');
      const value = document.querySelector('.score-value');

      value.textContent = score;

      // Color based on score
      if (score >= 80) {
        circle.style.borderColor = '#16a34a';
        circle.style.color = '#16a34a';
      } else if (score >= 60) {
        circle.style.borderColor = '#d97706';
        circle.style.color = '#d97706';
      } else {
        circle.style.borderColor = '#dc2626';
        circle.style.color = '#dc2626';
      }
    }

    function renderUserBreakdown(byUser) {
      const container = document.getElementById('user-list');

      if (!byUser || Object.keys(byUser).length === 0) {
        container.innerHTML = '<p class="text-muted">Engir notendur með verkefni</p>';
        return;
      }

      const users = Object.entries(byUser)
        .map(([username, data]) => ({ username, ...data }))
        .sort((a, b) => b.overdue - a.overdue || b.total - a.total);

      container.innerHTML = users.map(u => `
        <div class="user-row ${u.overdue > 0 ? 'has-overdue' : ''}">
          <div class="user-name">
            <i class="fas fa-user"></i> ${escapeHtml(u.username)}
          </div>
          <div class="user-stats">
            ${u.overdue > 0 ? `<span class="user-overdue">${u.overdue} seint</span>` : ''}
            ${u.dueSoon > 0 ? `<span class="user-due-soon">${u.dueSoon} bráðum</span>` : ''}
            <span class="user-total">${u.total} samtals</span>
          </div>
          <div class="user-bar">
            <div class="bar-fill" style="width: ${Math.min(u.total * 10, 100)}%">
              ${u.overdue > 0 ? `<div class="bar-overdue" style="width: ${(u.overdue / u.total) * 100}%"></div>` : ''}
            </div>
          </div>
        </div>
      `).join('');
    }

    async function loadAlerts() {
      try {
        const res = await fetch('/api/deadlines/alerts');
        const data = await res.json();

        // Update alert counts
        document.querySelector('#alert-critical .alert-count').textContent = data.critical || 0;
        document.querySelector('#alert-high .alert-count').textContent = data.high || 0;
        document.querySelector('#alert-medium .alert-count').textContent = data.medium || 0;
        document.querySelector('#alert-low .alert-count').textContent = data.low || 0;

        // Highlight if critical
        const alertBar = document.getElementById('alerts-bar');
        if (data.critical > 0) {
          alertBar.classList.add('has-critical');
        } else {
          alertBar.classList.remove('has-critical');
        }

      } catch (err) {
        console.error('Failed to load alerts:', err);
      }
    }

    async function loadCalendar() {
      const grid = document.getElementById('calendar-grid');
      const title = document.getElementById('calendar-title');
      const book = document.getElementById('book-filter').value;

      grid.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Hleður...</div>';

      try {
        const params = new URLSearchParams({
          month: currentMonth,
          year: currentYear
        });
        if (book) params.append('book', book);

        const res = await fetch('/api/deadlines/calendar?' + params);
        const data = await res.json();

        title.textContent = `${data.monthName} ${data.year}`;
        renderCalendar(data);

      } catch (err) {
        console.error('Failed to load calendar:', err);
        grid.innerHTML = '<div class="error">Villa við að hlaða dagatali</div>';
      }
    }

    function renderCalendar(data) {
      const grid = document.getElementById('calendar-grid');

      const dayNames = ['Sun', 'Mán', 'Þri', 'Mið', 'Fim', 'Fös', 'Lau'];

      let html = '<div class="calendar-header-row">';
      for (const day of dayNames) {
        html += `<div class="calendar-day-name">${day}</div>`;
      }
      html += '</div>';

      for (const week of data.weeks) {
        html += '<div class="calendar-week">';

        for (const day of week) {
          if (!day) {
            html += '<div class="calendar-cell empty"></div>';
          } else {
            const hasItems = day.items && day.items.length > 0;
            const hasOverdue = day.items && day.items.some(i => i.isOverdue);

            html += `
              <div class="calendar-cell ${day.isToday ? 'today' : ''} ${hasOverdue ? 'has-overdue' : ''} ${hasItems ? 'has-items' : ''}">
                <div class="cell-day">${day.dayOfMonth}</div>
                ${hasItems ? `
                  <div class="cell-items">
                    ${day.items.slice(0, 3).map(item => `
                      <div class="cell-item ${item.isOverdue ? 'overdue' : ''}" title="${item.book} K${item.chapter} - ${item.stageLabel} (${item.assignedTo})">
                        K${item.chapter}
                      </div>
                    `).join('')}
                    ${day.items.length > 3 ? `<div class="cell-more">+${day.items.length - 3}</div>` : ''}
                  </div>
                ` : ''}
              </div>
            `;
          }
        }

        html += '</div>';
      }

      grid.innerHTML = html;
    }

    function changeMonth(delta) {
      currentMonth += delta;
      if (currentMonth > 12) {
        currentMonth = 1;
        currentYear++;
      } else if (currentMonth < 1) {
        currentMonth = 12;
        currentYear--;
      }
      loadCalendar();
    }
    // Initialize
    init();
  </script>

  <script src="/js/theme.js"></script>

  <style>
    /* Page-specific styles for deadlines management */

    .container { max-width: 1400px; }

    .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
    .page-title h2 { font-size: 1.5rem; display: flex; align-items: center; gap: 0.5rem; }
    .page-title .text-muted { font-size: 0.875rem; color: var(--text-muted); }
    .page-actions { display: flex; gap: 0.5rem; align-items: center; }

    .btn-tiny { padding: 0.25rem 0.5rem; font-size: 0.75rem; }

    .badge-admin { background: var(--warning-light); color: #92400e; }
    .badge-editor { background: var(--primary-light); color: #1e40af; }

    /* Alerts Bar */
    .alerts-bar { display: flex; align-items: center; gap: 2rem; background: var(--bg-card); border-radius: 0.5rem; padding: 1rem 1.5rem; margin-bottom: 1.5rem; box-shadow: var(--shadow); }
    .alerts-bar.has-critical { border-left: 4px solid var(--error); }

    .health-score { display: flex; flex-direction: column; align-items: center; gap: 0.25rem; }
    .score-circle { width: 4rem; height: 4rem; border-radius: 50%; border: 4px solid var(--success); display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: 700; color: var(--success); }
    .score-label { font-size: 0.75rem; color: var(--text-muted); }

    .alert-summary { display: flex; gap: 1.5rem; flex: 1; }
    .alert-item { display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; border-radius: 0.375rem; background: var(--gray-50); }
    .alert-item.critical { background: var(--error-light); color: var(--error); }
    .alert-item.high { background: var(--warning-light); color: var(--warning); }
    .alert-item.medium { background: var(--primary-light); color: var(--primary); }
    .alert-item.low { background: var(--success-light); color: var(--success); }
    .alert-count { font-size: 1.25rem; font-weight: 700; }
    .alert-label { font-size: 0.75rem; }

    /* Stats Cards */
    .stats-cards { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
    .stat-card { background: var(--bg-card); border-radius: 0.5rem; padding: 1rem; display: flex; align-items: center; gap: 1rem; box-shadow: var(--shadow); }
    .stat-card .stat-icon { width: 3rem; height: 3rem; border-radius: 0.5rem; display: flex; align-items: center; justify-content: center; font-size: 1.25rem; background: var(--gray-100); color: var(--text-muted); }
    .stat-card.overdue .stat-icon { background: var(--error-light); color: var(--error); }
    .stat-card.warning .stat-icon { background: var(--warning-light); color: var(--warning); }
    .stat-card.info .stat-icon { background: var(--primary-light); color: var(--primary); }
    .stat-value { font-size: 1.5rem; font-weight: 700; color: var(--text-primary); }
    .stat-label { font-size: 0.8125rem; color: var(--text-muted); }

    /* Deadline Sections */
    .deadline-section { background: white; border-radius: 0.5rem; margin-bottom: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); overflow: hidden; }
    .deadline-section.overdue { border-left: 4px solid var(--error); }
    .deadline-section.due-soon { border-left: 4px solid var(--warning); }
    .deadline-section.this-week { border-left: 4px solid var(--primary); }
    .deadline-section.upcoming { border-left: 4px solid var(--success); }
    .deadline-section.no-date { border-left: 4px solid var(--gray-400); }

    .section-header { display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 1rem; background: var(--gray-50); border-bottom: 1px solid var(--gray-200); }
    .section-header h3 { font-size: 0.9375rem; display: flex; align-items: center; gap: 0.5rem; }
    .deadline-section.overdue .section-header h3 { color: var(--error); }
    .deadline-section.due-soon .section-header h3 { color: var(--warning); }
    .section-count { font-size: 0.75rem; background: var(--gray-200); color: var(--gray-600); padding: 0.125rem 0.5rem; border-radius: 9999px; }

    .section-items { padding: 0.5rem; }

    .deadline-item { display: flex; align-items: center; gap: 1rem; padding: 0.75rem; border-radius: 0.375rem; transition: background 0.15s; }
    .deadline-item:hover { background: var(--gray-50); }

    .item-left { display: flex; align-items: center; gap: 0.75rem; min-width: 200px; }
    .status-badge { font-size: 0.6875rem; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-weight: 600; min-width: 50px; text-align: center; }
    .status-badge.overdue { background: #fee2e2; color: #991b1b; }
    .status-badge.due-soon { background: #fef3c7; color: #92400e; }
    .status-badge.this-week { background: #dbeafe; color: #1e40af; }
    .status-badge.upcoming { background: #dcfce7; color: #166534; }
    .status-badge.no-date { background: var(--gray-200); color: var(--gray-600); }

    .item-title { font-weight: 600; font-size: 0.875rem; }
    .item-stage { font-size: 0.75rem; color: var(--gray-500); }

    .item-middle { flex: 1; }
    .item-assignee { font-size: 0.8125rem; color: var(--gray-600); }
    .item-assignee i { margin-right: 0.25rem; color: var(--gray-400); }

    .item-right { text-align: right; min-width: 150px; }
    .item-date { font-size: 0.8125rem; color: var(--gray-600); }
    .item-date i { margin-right: 0.25rem; }
    .item-date.overdue { color: var(--error); }
    .item-days { font-size: 0.75rem; margin-top: 0.125rem; }
    .days-overdue { color: var(--error); font-weight: 600; }
    .days-today { color: var(--warning); font-weight: 600; }
    .days-tomorrow { color: var(--warning); }
    .days-left { color: var(--gray-500); }
    .no-date { color: var(--gray-400); font-size: 0.75rem; }

    .item-actions { margin-left: 0.5rem; }

    /* User Breakdown */
    .card { background: white; border-radius: 0.5rem; padding: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-top: 1.5rem; }
    .card h3 { font-size: 1rem; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }

    .user-row { display: flex; align-items: center; gap: 1rem; padding: 0.5rem 0; border-bottom: 1px solid var(--gray-100); }
    .user-row:last-child { border-bottom: none; }
    .user-row.has-overdue { background: #fef2f2; margin: 0 -1rem; padding: 0.5rem 1rem; }

    .user-name { min-width: 150px; font-size: 0.875rem; }
    .user-name i { margin-right: 0.5rem; color: var(--gray-400); }

    .user-stats { display: flex; gap: 0.75rem; min-width: 200px; }
    .user-overdue { font-size: 0.75rem; color: var(--error); font-weight: 600; }
    .user-due-soon { font-size: 0.75rem; color: var(--warning); }
    .user-total { font-size: 0.75rem; color: var(--gray-500); }

    .user-bar { flex: 1; height: 0.5rem; background: var(--gray-200); border-radius: 0.25rem; overflow: hidden; }
    .bar-fill { height: 100%; background: var(--primary); position: relative; }
    .bar-overdue { position: absolute; left: 0; top: 0; height: 100%; background: var(--error); }

    /* Calendar */
    .calendar-header { display: flex; justify-content: center; align-items: center; gap: 1rem; padding: 1rem; background: white; border-radius: 0.5rem 0.5rem 0 0; }
    .calendar-header h3 { min-width: 200px; text-align: center; }

    .calendar-grid { background: white; border-radius: 0 0 0.5rem 0.5rem; padding: 1rem; }

    .calendar-header-row, .calendar-week { display: grid; grid-template-columns: repeat(7, 1fr); gap: 0.25rem; }
    .calendar-day-name { text-align: center; font-size: 0.75rem; font-weight: 600; color: var(--gray-500); padding: 0.5rem; }

    .calendar-cell { min-height: 80px; border: 1px solid var(--gray-200); border-radius: 0.25rem; padding: 0.25rem; background: white; }
    .calendar-cell.empty { background: var(--gray-50); border-color: transparent; }
    .calendar-cell.today { border-color: var(--primary); background: #eff6ff; }
    .calendar-cell.has-overdue { border-color: var(--error); }
    .calendar-cell.has-items { background: #f0fdf4; }

    .cell-day { font-size: 0.75rem; font-weight: 600; color: var(--gray-700); margin-bottom: 0.25rem; }
    .calendar-cell.today .cell-day { color: var(--primary); }

    .cell-items { display: flex; flex-direction: column; gap: 0.125rem; }
    .cell-item { font-size: 0.625rem; padding: 0.125rem 0.25rem; background: var(--primary); color: white; border-radius: 0.125rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .cell-item.overdue { background: var(--error); }
    .cell-more { font-size: 0.625rem; color: var(--gray-500); text-align: center; }

    /* States */
    .loading, .error, .empty-state { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 3rem; color: var(--gray-500); text-align: center; }
    .loading i, .error i, .empty-state i { font-size: 2rem; margin-bottom: 1rem; }
    .empty-state i { color: var(--success); }
    .empty-state h3 { color: var(--gray-700); margin-bottom: 0.5rem; }

    /* Responsive */
    @media (max-width: 1024px) {
      .stats-cards { grid-template-columns: repeat(2, 1fr); }
      .alert-summary { flex-wrap: wrap; }
    }

    @media (max-width: 768px) {
      .stats-cards { grid-template-columns: 1fr; }
      .page-header { flex-direction: column; gap: 1rem; align-items: stretch; }
      .deadline-item { flex-direction: column; align-items: flex-start; gap: 0.5rem; }
      .item-left, .item-middle, .item-right { min-width: auto; width: 100%; }
      .item-right { text-align: left; }
      .alerts-bar { flex-direction: column; gap: 1rem; }
      .user-row { flex-direction: column; align-items: flex-start; }
      .user-bar { width: 100%; }
    }
  </style>
</body>
</html>
